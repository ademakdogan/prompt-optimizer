# ============================================================================
# Prompt Optimizer - Test Dockerfile
# ============================================================================
FROM python:3.13-slim

# Install uv
COPY --from=ghcr.io/astral-sh/uv:latest /uv /usr/local/bin/uv

# Set environment variables
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    UV_COMPILE_BYTECODE=1 \
    UV_LINK_MODE=copy \
    PATH="/app/.venv/bin:$PATH"

# Set working directory
WORKDIR /app

# Copy all project files
COPY pyproject.toml uv.lock README.md ./
COPY src/ ./src/
COPY tests/ ./tests/
COPY resources/ ./resources/

# Install all dependencies (including dev/test)
RUN uv sync --frozen --extra dev

# Default command runs tests
CMD ["python", "-m", "pytest", "tests/", "-v", "--tb=short"]
