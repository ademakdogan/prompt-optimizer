services:
  prompt-optimizer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: prompt-optimizer
    env_file:
      - .env
    volumes:
      # Mount resources for custom datasets
      - ./resources:/app/resources:ro
      # Mount output directory for results
      - ./output:/app/output
      # Mount output files to project root
      - ./final_prompt.txt:/app/final_prompt.txt
      - ./mentor_prompts.txt:/app/mentor_prompts.txt
    working_dir: /app
    command: ["python", "-m", "prompt_optimizer", "--help"]
    
  # Service for running optimization
  optimize:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: prompt-optimizer-run
    env_file:
      - .env
    volumes:
      - ./resources:/app/resources:ro
      - ./output:/app/output
      - ./final_prompt.txt:/app/final_prompt.txt
      - ./mentor_prompts.txt:/app/mentor_prompts.txt
    working_dir: /app
    command: >
      python -m prompt_optimizer 
      --data resources/test_mapping.json 
      --samples 5 
      --loops 3
    profiles:
      - run
